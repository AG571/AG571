name: Daily heartbeat

on:
  workflow_dispatch:
  schedule:
    - cron: '15 07 * * *'  # daily 07:15 UTC

permissions:
  contents: write

jobs:
  hb:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Write heartbeat file
        shell: bash
        run: |
          set -e
          echo "Last update: $(date -u +%F)T$(date -u +%H:%M:%SZ)" > heartbeat.txt

      - name: Commit and push
        env:
          GH_TOKEN: ${{ secrets.PAT_PUSH }}
        shell: bash
        run: |
          set -e
          git config user.name "Aviv Geron"
          git config user.email "geron.aviv@hotmail.com"
          git add heartbeat.txt
          git commit -m "chore: heartbeat" || echo "No changes to commit"
          git push "https://x-access-token:${GH_TOKEN}@github.com/${{github.repository}}" HEAD:main
